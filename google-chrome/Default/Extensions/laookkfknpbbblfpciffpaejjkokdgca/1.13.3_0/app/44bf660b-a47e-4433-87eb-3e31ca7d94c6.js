var fn_addin=function(v,l,t){var n=n||{};n.styles=n.styles||{},n.commands=n.commands||{},n.dependencies=t||n.dependencies||{},n.styles.style=function(){},n.views=n.views||{},n.collect=n.collect||{},n.models=n.models||{},n.templates=n.templates||{},n.info={widget:!0,placeholderType:"none",id:"metric_new_detail",addin:"44bf660b-a47e-4433-87eb-3e31ca7d94c6",dependencies:["metrics"]},v.console.log(v.elapsed()+": "+n.info.id+" started"),n.templates=n.templates||{},n.templates.editMetric=Handlebars.template({compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,n){var s,a=this.lambda,o=this.escapeExpression;return'<div class="input-group metric-name-group">\n\t<label for="metric-name">Name</label>\n\t<input type="text" name="metric-name" id="metric-edit-label" class="metric-edit-input" placeholder="" data-test="metric-name" autocomplete="off">\n</div>\n\n\n\x3c!-- Metric types --\x3e\n<div class="metric-type">\n\n\t<div class="label-group metric-type-header">\n\t\t<span class="metric-type-label">Choose a Type</span>\n\n\t\t<div class="icon-wrapper back-to-types" data-tab="type">\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212.982 212.982" class="icon icon-hide"><path d="M131.804 106.491l75.936-75.936c6.99-6.99 6.99-18.323 0-25.312-6.99-6.99-18.322-6.99-25.312 0L106.491 81.18 30.554 5.242c-6.99-6.99-18.322-6.99-25.312 0-6.989 6.99-6.989 18.323 0 25.312l75.937 75.936-75.937 75.937c-6.989 6.99-6.989 18.323 0 25.312 6.99 6.99 18.322 6.99 25.312 0l75.937-75.937 75.937 75.937c6.989 6.99 18.322 6.99 25.312 0 6.99-6.99 6.99-18.322 0-25.312l-75.936-75.936z"/></svg>\n\t\t</div>\n\t</div>\n\n\t<div class="types">\n\t\t<div class="button-list type type-type type-nav active">\n\t\t\t<div class="button-list-item type-nav-item manual-option" data-tab="manual">\n\t\t\t\t<div class="button-list-item-title">'+o(a(null!=(s=null!=t?t.labels:t)?s.manual:s,t))+'</div>\n\t\t\t\t<div class="button-list-item-description">Track manually</div>\n\t\t\t</div>\n\t\t\t<div class="button-list-item type-nav-item url-option" data-tab="url">\n\t\t\t\t<div class="button-list-item-title">'+o(a(null!=(s=null!=t?t.labels:t)?s.url:s,t))+'</div>\n\t\t\t\t<div class="button-list-item-description">Update from a URL</div>\n\t\t\t</div>\n\t\t\t<div class="button-list-item type-nav-item integration-option" data-tab="integration">\n\t\t\t\t<div class="button-list-item-title">'+o(a(null!=(s=null!=t?t.labels:t)?s.integration:s,t))+'</div>\n\t\t\t\t<div class="button-list-item-description">Connect to a service</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="type manual-type">\n\t\t\t<div class="input-group value-group">\n\t\t\t\t<label for="metric-value">Value</label>\n\t\t\t\t<input type="text" name="metric-value" id="metric-edit-value" class="metric-edit-input" placeholder="0" data-test="metric-value" autocomplete="off">\n\t\t\t</div>\n\n\t\t\t\x3c!-- Reset --\x3e\n\t\t\t<div class="input-group has-toggle reset-metric-group" data-test="metric-reset">\n\t\t\t\t<label for="reset-metric">Reset</label>\n\t\t\t\t<div class="select-wrapper">\n\t\t\t\t\t<select name="reset-metric" id="reset-metric">\n\t\t\t\t\t\t<option value="none">Never</option>\n\t\t\t\t\t\t<option value="daily">Daily</option>\n\t\t\t\t\t\t<option value="weekly">Weekly</option>\n\t\t\t\t\t\t<option value="monthly">Monthly</option>\n\t\t\t\t\t\t<option value="yearly">Yearly</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="type url-type">\n\t\t\t<div class="input-group">\n\t\t\t\t<label for="metric-edit-url">Url</label>\n\t\t\t\t<input id="metric-edit-url" class="metric-edit-input" data-property=\'url\' name="edit-metric-url" type="text" placeholder="http://" autocomplete="off">\n\t\t\t\t<div class="input-description">Enter an API address <a href="https://get.momentumdash.help/hc/en-us/articles/360038089754#h_b3d82248-1a7f-40c1-9304-01b0421dacca" target="_blank">More</a></div>\n\t\t\t</div>\n\t\t\t<div class="input-group path-group">\n\t\t\t\t<label for="path">Value</label>\n\t\t\t\t<div class="select-wrapper">\n\t\t\t\t\t<select name="path" id="metric-edit-path" class="metric-path" data-test="matric-path"></select>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n\t\t<div class="type integration-type">\n\t\t\t<div class="integration-step choose-provider active">\n\t\t\t\t<div class="providers">\n\t\t\t\t\t<ul class="tile-list integration-list provider-list add-provider">\n\t\t\t\t\t\t<li><span class="loading"><i class="loading-icon"></i>Loading...</span></li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<a href="https://suggestions.momentumdash.help/" class="suggest" target="_blank">Suggest integration &rarr;</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="integration-step connect-provider">\n\t\t\t\t<label>Connect to <span class="connecting-provider"></span></label>\n\n\t\t\t\t<div class="description">A secure window will open. Momentum doesn\'t see or access your login info.</div>\n\n\t\t\t\t<div class="button-group">\n\t\t\t\t\t<span class="button connect">Connect</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="integration-step chosen-provider">\n\n\t\t\t\t<div class="provider-info">\n\t\t\t\t\t<img class="provider-logo" src=""><span class="provider-name"></span>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="input-group provider-metric">\n\t\t\t\t\t<label>Value</label>\n\t\t\t\t\t<div class="select-wrapper">\n\t\t\t\t\t\t<select>\n\t\t\t\t\t\t\t<option class="provider-metric-name"></option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="re-auth">\n\t\t\t\t\t<span class="button connect">Reconnect</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n\x3c!-- Pinned --\x3e\n<div class="input-group has-toggle create-pinned-group" data-test="metric-pin">\n\t<label for="create-pinned">Pinned</label>\n\t<span class="toggle-slider"><svg class="toggle-switch" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle\n\t\t\tcx="50" cy="50" r="50"/></svg></span>\n</div>\n\n\n<div class="metric-edit-controls">\n\t<span class="error-message"><span class="save-error"></span></span>\n\t<span class="button save" data-test="countdown-save">Save</span>\n</div>\n'},useData:!0}),n.templates.provider=Handlebars.template({1:function(t,e,i,n){return"connect-provider"},3:function(t,e,i,n){return"use-provider"},compiler:[6,">= 2.0.0-beta.1"],main:function(t,e,i,n){var s,a,o=e.helperMissing,r="function",l=this.escapeExpression;return'<div data-provider-id="'+l(typeof(a=null!=(a=e.id||(null!=t?t.id:t))?a:o)==r?a.call(t,{name:"id",hash:{},data:n}):a)+'" class="'+(null!=(s=e.if.call(t,null!=t?t.notConnected:t,{name:"if",hash:{},fn:this.program(1,n,0),inverse:this.noop,data:n}))?s:"")+" "+(null!=(s=e.unless.call(t,null!=t?t.notConnected:t,{name:"unless",hash:{},fn:this.program(3,n,0),inverse:this.noop,data:n}))?s:"")+' available-provider button-list-item">\n\t<img class="button-list-item-img" src="'+l(typeof(a=null!=(a=e.small_icon_url||(null!=t?t.small_icon_url:t))?a:o)==r?a.call(t,{name:"small_icon_url",hash:{},data:n}):a)+'">\n\t<div class="button-list-item-title">'+l(typeof(a=null!=(a=e.provider_title||(null!=t?t.provider_title:t))?a:o)==r?a.call(t,{name:"provider_title",hash:{},data:n}):a)+"</div>\n</div>\n"},useData:!0}),n.styles=n.styles||{},n.styles.style=function(){var t=document.createElement("style");t.type="text/css",t.innerHTML=".button-list-item{margin-bottom:.5rem;padding:6px 9px;border:1px solid var(--border-color);border-radius:3px;cursor:pointer}.button-list .button-list-item:last-child{margin-bottom:0}.button-list-item:hover{background:rgba(255,255,255,.1)}.light .button-list-item:hover{background:rgba(0,0,0,.05)}.button-list-item:hover:active{background:rgba(255,255,255,.2);transition-duration:0s}.integration-step,.metric-type .type,.metric-type .types{transition:.3s opacity ease-in}.light .button-list-item:hover:active{background:rgba(0,0,0,.1)}.button-list-item-title{opacity:.8;font-size:.9375rem}.button-list-item-description{padding-top:1px;opacity:.5;font-size:.75rem}.tile-list{display:flex;flex-wrap:wrap;justify-content:space-between}.tile-list .button-list-item{width:48%;box-sizing:border-box;text-align:center}.tile-list .button-list-item-img{width:24px;padding:3px 0}.tile-list .button-list-item-title{margin:0;font-size:.8125rem}.input-description{margin:.25rem 0 -4px;font-size:.8125rem;opacity:.7}.input-description a{padding:2px;opacity:.65}.input-description a:hover{opacity:.85}.input-description a:active{opacity:1}.metric-type-header{margin-bottom:9px;display:flex}.editing .metric-type-header{display:none}.metric-type-header .metric-type-label{flex-grow:1;opacity:.8;font-size:.9375rem}.metric-type-header .back-to-types{visibility:hidden}.metric-type-header .back-to-types.active{visibility:visible}.metric-type-header .icon-hide{--size:9px;height:var(--size);width:var(--size);opacity:.5}.metric-type-header .icon-wrapper:hover .icon-hide{opacity:.8}.metric-type .types{position:relative;margin-bottom:21px}.metric-type .type{position:absolute;top:0;right:0;left:0;z-index:-1;display:flex;flex-direction:column;opacity:0;visibility:hidden;white-space:normal}.metric-type .type.active{z-index:1;opacity:1;visibility:visible}.metric-detail .reset-metric-group{margin-bottom:0;display:flex;align-items:center;justify-content:space-between}.path-group .select-wrapper{width:100%}.app .input-group.path-group{margin-bottom:0;display:none}.app .has-url .input-group.path-group{display:block}.integration-type .suggest{margin:-2px;padding:2px;opacity:.7;font-size:.75rem;font-weight:500}.integration-type .suggest:hover{opacity:1}.integration-type .empty{min-height:1px;font-size:.8125rem}.integration-step{max-height:0;margin:0;opacity:0;visibility:hidden}.integration-step.active{max-height:150px;margin:6px 0 0;opacity:1;visibility:visible}.connect-provider label{opacity:.9}.connect-provider .description{margin:.5rem 0;opacity:.6;font-size:.8125rem}.connect-provider .button-group{margin-top:5px}.chosen-provider .provider-info{margin:2px 0 14px;display:flex;align-items:center}.chosen-provider .provider-logo{width:24px;margin-right:7px}.chosen-provider .provider-metric{margin-bottom:0}.chosen-provider .select-wrapper{width:100%}.re-auth{display:none;margin:10px 0 0;flex-direction:row}.auth-needed .re-auth{display:flex}.create-pinned-group,.metric-edit-controls,.metric-name-group{height:auto;opacity:1;transition:opacity .3s ease-in;visibility:visible}.preliminary .create-pinned-group,.preliminary .metric-edit-controls,.preliminary .metric-name-group{height:0;margin:0;padding:0;opacity:0;overflow-y:hidden;visibility:hidden}.preliminary .type:not(.type-type),.preliminary .type:not(.type-type) .integration-step{visibility:hidden}",document.getElementsByTagName("head")[0].appendChild(t)},n.views.Metric=Backbone.View.extend({attributes:{class:"preliminary"},events:{"paste #metric-edit-url":"updateUrl","change #metric-edit-url":"updateUrl","change #metric-edit-path":"updatePath","keyup #metric-edit-url":"checkUrl","keyup #metric-edit-label":"updateLabel","keyup #metric-edit-value":"updateLabel","change #reset-metric":"updateLabel","click .save":"saveMetric","click .create-pinned-group":"togglePinned","click .type-nav-item":"switchTab","click .back-to-types":"switchTab","click .connect-provider":"initiateConnectProvider","click .use-provider":"useProvider","click .connect":"connectProvider"},initialize:function(t){this.labels={manual:"Manual",url:"From a URL",integration:"From an Integration",type:"Choose a Type"},this.providerStates={CHOOSE_PROVIDER:"$chooseProvider",CHOSEN_PROVIDER:"$chosenProvider",CONNECT_PROVIDER:"$connectProvider"},this.collection=t.collection,this.parentView=t.parentView,this.template=n.templates.editMetric,this.integrationCollection=new Backbone.Collection,this.integrationCollection.url=v.globals.urlRoot+"settings/metrics";var e=this;this.integrationCollection.parse=function(t){return(e.integrationCollection.lastResponse=t).connected_providers},this.listenTo(this.integrationCollection,"reset",this.integrationCollectionReset),this.refreshData(),this.parentView.addItemMenu({text:"Reconnect",class:"reconnect"}).on("click",function(){e.parentView.toggleDropdown();var t=v.globals.urlRootApi+"settings/metrics/providers/"+e.activeProvider.id;l.ajax({type:"DELETE",contentType:"application/json",beforeSend:setMomentumAuthHeader,url:t}).done(function(t){e.$el.addClass("reconnecting"),e.connectProvider()})})},render:function(t){return(t=t||{}).labels=this.labels,this.$el.html(this.template(t)),this},checkUrl:function(t){var e=this;this.lastKeyTypedOn=v.now(),13===t.keyCode?this.updateUrl():setTimeout(function(){400<v.now()-e.lastKeyTypedOn&&e.updateUrl()},500)},updateLabel:function(){var t=this.$label.val().trim();this.$saveButton.toggleClass("disabled",0===t.length)},updatePath:function(){var t=this.$path[0].selectedIndex;this.$saveButton.toggleClass("disabled",t<=0||0===this.$label.val().trim().length)},updateUrl:function(n){var s=this,a=n&&"function"==typeof n,t=this.$url.val().trim();if(this.lastUrl!==t){if(0===t.length)return this.$el.removeClass("has-url"),void setTimeout(function(){s.parentView.setHeight()},330);var o="<option selected class='path-guide'>Loading…</option>";this.$dropdownList.html(""),this.$dropdownList.append(o),this.$el.addClass("has-url"),this.setHeightInAnimation(),this.$saveButton.addClass("disabled"),this.lastUrl=t,l.ajax({type:"POST",contentType:"application/json",beforeSend:setMomentumAuthHeader,url:v.globals.urlRootApi+"metrics/preview",data:JSON.stringify({url:t})}).done(function(t,e,i){s.suggestionList=t.values,s.$dropdownList.html(""),s.$dropdownList.append(o),a||s.$(".metric-path").fadeOut(300,function(){s.suggestionList&&0<s.suggestionList.length?s.$(".path-guide").html("Select"):(s.$(".path-guide").html("Not found"),s.$saveButton.addClass("disabled")),s.$(".metric-path").fadeIn(300)}),s.suggestionList.forEach(function(t){s.$dropdownList.append('<option data-id="'+t.path+'" value="'+t.path+'"><span class="path-option">'+t.name+":  "+t.value+"</span></option>")}),s.$el.removeClass("search-loading"),a&&n()}).fail(function(t,e){s.$(".metric-path").fadeOut(300,function(){s.$(".path-guide").html("Not found"),s.$saveButton.addClass("disabled"),s.$(".metric-path").fadeIn(300)})})}},startAdding:function(t){this.$el.find(".save").show(),this.resetView(),this.$el.addClass("preliminary"),this.setHeight()},saveMetric:function(t){t&&t.stopPropagation(),this.save(this.model||null,!0)},save:function(t,e){if(!this.$saveButton.hasClass("disabled")){this.$el.find(".error-message").hide();var i=this.$value.val()||t&&t.get("value")||0,n=capitalizeWords((this.$label.val()||"").trim());if(0!==n.length){var s=this.$pinned.hasClass("on"),a=parseFloat(i);isNaN(a)||a+""!=i||(i=a);var o=this.$url.val(),r=this.$path.val(),l=this.$("#reset-metric").val(),c=(o=o&&o.trim())&&0<o.length;if(c||"url"!==this.selectedTab){var d=t?t.get("providerId"):this.activeProvider?this.activeProvider.id:null,p={url:c?o:null,path:r,value:c?this.suggestionList[this.$path[0].selectedIndex-1].value:d&&!t?"Loading…":i,label:n,pinned:s,cycle:l,modified:v.now(),providerId:d},h=this;return t?(t.save(p,{ignoreRender:!0}),e&&this.parentView.switchToListView()):(p.custom=!0,this.model=this.parentView.createMetric(p),d&&setTimeout(function(){h.collection.fetch({skipLocalFetch:!0})},200)),t||this.model}this.$url.trigger("focus")}else this.$label.trigger("focus")}},resetView:function(t){this.model=null,t||(this.render({}),this.collectElements()),this.$el.removeClass("editing"),this.$el.removeClass("auth-needed"),this.$saveError.hide(),this.$label.val(""),this.$("#reset-metric").val(this.collection.Cycles.NONE),this.$value.val(""),this.$url.val(""),this.$path.val(""),this.$pinned.removeClass("on"),this.$el.removeClass("has-url"),this.$saveButton.addClass("disabled"),this.$url.val(""),this.$path.val(""),this.parentView.$(".reconnect").hide(),this.updateUrl(),this.lastUrl=null,this.selectedTab=null,this.activeProvider=null;var e=this;setTimeout(function(){e.$label.trigger("focus")},350)},collectElements:function(){this.$saveError=this.$(".error-message"),this.$saveButton=this.$(".save"),this.$label=this.$("#metric-edit-label"),this.$value=this.$("#metric-edit-value"),this.$url=this.$("#metric-edit-url"),this.$path=this.$("#metric-edit-path"),this.$pinned=this.$(".create-pinned-group"),this.$saveButton=this.$(".save"),this.$dropdownList=this.$(".metric-path"),this.$type=this.$(".type-type"),this.$metrics=l(this.$el.find(".settings-metrics")[0]),this.$chosenProvider=this.$(".chosen-provider"),this.$connectProvider=this.$(".connect-provider"),this.$chooseProvider=this.$(".choose-provider"),this.$connect=this.$(".settings-connect"),this.$backToTypes=this.$(".back-to-types"),this.$typeLabel=this.$(".metric-type-label"),this.$connectionProviderLabel=this.$(".connecting-provider")},editDetail:function(t){this.resetView(),this.$el.removeClass("preliminary"),this.$el.addClass("editing"),this.model=t,this.$label.val(t.get("label")),this.$("#reset-metric").val(t.get("cycle")||"none");var e=t.getValue();"Authorization needed."===e?(this.$el.addClass("auth-needed"),this.$value.val("!")):this.$value.val(e),this.$url.val(t.get("url"));var i=this;this.$pinned.toggleClass("on",t.get("pinned")),t.hasUrl()?(this.selectTab("url"),this.updateUrl(function(){i.$path.val(t.get("path")),i.setHeight()})):t.get("providerId")?(this.parentView.$(".reconnect").show(),this.setProviderState(this.providerStates.CHOSEN_PROVIDER),this.integrationCollection.lastResponse?(this.activeProvider=_.findWhere(this.integrationCollection.lastResponse.connected_providers,{id:t.get("providerId")}),this.showActiveProvider()):this.loadActiveProvider=!0,this.selectTab("integration")):(this.activeProvider=null,this.selectTab("manual"))},showActiveProvider:function(){this.$(".provider-logo").attr("src",this.activeProvider.large_icon_url),this.$(".provider-name").text(this.activeProvider.provider_title),this.$(".provider-metric-name").text(this.activeProvider.short_description)},getsubviews:function(t){return this.subviews&&this.subviews.is(":visible")||(this.subviews=this.$el.find(".subviews.adding-subviews")),this.subviews},showOptions:function(){this.showPane(),this.sourcesLoaded?this.showSources():this.loading=!0},showPane:function(t){var e=this.getsubviews();e.removeClass("second"),e.removeClass("third"),t&&(e.addClass(t),this.setHeight())},hideDetail:function(t){this.getsubviews().removeClass("second"),this.setHeight()},setHeightInAnimation:function(){var t=this;setTimeout(function(){t.setHeight()},100),setTimeout(function(){t.setHeight()},200),setTimeout(function(){t.setHeight()},300),setTimeout(function(){t.setHeight()},400)},setHeight:function(){this.setTabHeight();var t=this.getsubviews(),e=t.hasClass("second")?1:0;t.css("max-height",l(t.children()[e]).outerHeight(!0)+"px"),this.parentView.setHeightInAnimation()},togglePinned:function(){this.$pinned.toggleClass("on"),this.updateLabel()},selectTab:function(t){this.selectedTab!==t&&("type"===t&&this.resetView(!0),"integration"===(this.selectedTab=t)?this.integrationCollectionReset():this.activeProvider=null,this.$type=this.$("."+t+"-type"),l(".type").removeClass("active"),this.$el.toggleClass("preliminary","type"===t),this.$type.addClass("active"),this.$backToTypes.toggleClass("active","type"!==t),this.$typeLabel.hide(),this.$typeLabel.html(this.labels[t]),this.$typeLabel.fadeIn(300),this.setHeight())},setTabHeight:function(){this.$(".types").height(this.$type.outerHeight(!0))},setProviderState:function(t){this.$(".integration-step").removeClass("active"),this[t].addClass("active")},switchTab:function(t){this.selectTab(t.currentTarget.dataset.tab),this.setProviderState(this.providerStates.CHOOSE_PROVIDER),this.setHeightInAnimation()},integrationCollectionReset:function(){if(this.populateIntegrations()){this.refreshing=!1,this.loadActiveProvider&&this.model&&(this.activeProvider=_.findWhere(this.integrationCollection.lastResponse.connected_providers,{id:this.model.get("providerId")}),this.showActiveProvider(),this.loadActiveProvider=!1),this.setHeight();var t=this;v.connectProvider=function(){t.$connectionProviderLabel.html("Todoist"),t.setProviderState(t.providerStates.CONNECT_PROVIDER),t.setHeightInAnimation()},v.authNeeded=function(){t.$el.addClass("auth-needed"),t.setHeightInAnimation()}}},refreshData:function(){this.refreshing=!0,this.integrationCollection.fetch({reset:!0})},initiateConnectProvider:function(t){if(t&&(t.stopPropagation(),t.preventDefault()),v.conditionalFeatures.featureEnabled("plus")){var e=l(t.currentTarget).data("provider-id"),i=this.getProvider(e);(this.activeProvider=i).active&&(this.$connectionProviderLabel.html(i.provider_title),this.setProviderState(this.providerStates.CONNECT_PROVIDER),this.setHeightInAnimation())}else{var n={targetRegion:"metrics",sourceEvent:"metric-"+this.activeProvider.id,buttonText:"Learn more",title:"Metrics",description:"Keep track of your important metrics at a glance"};v.commandManager.execute("upsell.message",n)}},getProvider:function(t){var e=_.findWhere(this.integrationCollection.lastResponse.available_providers,{id:t});return e=e||_.findWhere(this.integrationCollection.lastResponse.connected_providers,{id:t})},connectProvider:function(t){t&&(t.stopPropagation(),t.preventDefault()),l(this.$el.find("#connect-button")[0]).html("Connecting...");var r=this;this.authAttempts=0;var e=this.activeProvider.id,i=v.globals.urlRootApi+"settings/metrics/providers",n={provider_id:e};l.ajax({type:"PUT",contentType:"application/json",beforeSend:setMomentumAuthHeader,url:i,data:JSON.stringify(n)}).done(function(t){if(t.status&&"authRequired"===t.status){if(t.authorizationUrl&&r.authAttempts<2){r.authAttempts++;var e=t.winWidth?t.winWidth:600,i=t.winHeight?t.winHeight:510,n=t.windowFeatures?t.windowFeatures:"titlebar,resizable,status",s=window.screen.width/2-e/2,a=window.screen.height/2-i/2,o=window.open(t.authorizationUrl,"MomentumAuthWindow",n+",left="+s+",top="+a+",width="+e+",height="+i);!function t(){o.closed?r.integrationCollection.fetch({success:function(){0!==r.integrationCollection.lastResponse.connected_providers.find(function(t){return t.id===r.activeProvider.id}).status.indexOf("Awaiting")&&((r.$el.hasClass("auth-needed")||r.$el.hasClass("reconnecting"))&&(r.collection.fetch({skipLocalFetch:!0}),r.model.set({value:"Loading…"},{ignoreSave:!0}),r.$el.removeClass("auth-needed reconnecting"),r.parentView.switchToListView()),r.useProvider())}}):setTimeout(t,100)}()}}else t.status&&"success"===t.status&&r.refreshData()})},useProvider:function(t){if(t){var e=l(t.currentTarget).data("provider-id");this.activeProvider=this.getProvider(e),this.$label.val(this.activeProvider.short_description),this.$saveButton.removeClass("disabled")}this.showActiveProvider(),this.$connectionProviderLabel.html(this.activeProvider.provider_title),this.setProviderState(this.providerStates.CHOSEN_PROVIDER),this.setHeightInAnimation()},cancelConnect:function(t){t&&(t.stopPropagation(),t.preventDefault()),this.$connect.hide(),this.$metrics.css("display","block")},populateIntegrations:function(){if(this.integrationCollection.lastResponse){var e=this.$el.find(".provider-list");e.html("");var t=this.integrationCollection.lastResponse.available_providers;t&&t.map(function(t){t.notConnected=!0,e.append(n.templates.provider(t))});var i=this.integrationCollection.lastResponse.connected_providers;return i&&i.map(function(t){t.notConnected="Connected"!==t.status,e.append(n.templates.provider(t))}),!0}this.refreshing||this.refreshData()}});var e=n.dependencies.metrics;return n.styles.style(),e.views.metric.setDetailViewClass(n.views.Metric),n};m.addinManager&&m.addinManager.registerAddinFn("44bf660b-a47e-4433-87eb-3e31ca7d94c6",fn_addin);